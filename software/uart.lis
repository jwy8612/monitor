                        .module uart.c
                        .area text(rom, con, rel)
 0000                   .dbfile source\uart.c
 0000                   .dbfile D:\monitor\software\source\uart.c
 0000                   .dbfunc e uart0_init _uart0_init fV
                        .even
 0000           _uart0_init::
 0000                   .dbline -1
 0000                   .dbline 9
 0000           ; #include "define.h"
 0000           ; 
 0000           ; //UART0 initialize
 0000           ; // desired baud rate: 115200
 0000           ; // actual: baud rate:115198 (0.0%)
 0000           ; extern okflag;
 0000           ; extern u8 mstxt[100];
 0000           ; void uart0_init(void)
 0000           ; {
 0000                   .dbline 10
 0000           ;       DDRD |= 1<<1; 
 0000 899A              sbi 0x11,1
 0002                   .dbline 49
 0002           ; #ifdef CLOCK11059
 0002           ; #ifdef UART115200
 0002           ;        UCSRB = 0x00; //disable while setting baud rate
 0002           ;        UCSRA = 0x00;
 0002           ;        UCSRC = BIT(URSEL) | 0x06;
 0002           ;        UBRRL = 0x05; //set baud rate lo
 0002           ;        UBRRH = 0x00; //set baud rate hi
 0002           ;        UCSRB = 0x98;
 0002           ; #endif
 0002           ; #ifdef UART57600
 0002           ;        UCSRB = 0x00; //disable while setting baud rate
 0002           ;        UCSRA = 0x00;
 0002           ;        UCSRC = BIT(URSEL) | 0x06;
 0002           ;        UBRRL = 0x0B; //set baud rate lo
 0002           ;        UBRRH = 0x00; //set baud rate hi
 0002           ;        UCSRB = 0x98;
 0002           ; #endif
 0002           ; #endif
 0002           ; #ifdef CLOCK73728
 0002           ; #ifdef UART115200
 0002           ;       UCSRB = 0x00; //disable while setting baud rate
 0002           ;       UCSRA = 0x00;
 0002           ;       UCSRC = BIT(URSEL) | 0x06;
 0002           ;       UBRRL = 0x03; //set baud rate lo
 0002           ;       UBRRH = 0x00; //set baud rate hi
 0002           ;       UCSRB = 0x98;
 0002           ; 
 0002           ; #endif
 0002           ; #ifdef UART57600
 0002           ;       UCSRB = 0x00; //disable while setting baud rate
 0002           ;       UCSRA = 0x00;
 0002           ;       UCSRC = BIT(URSEL) | 0x06;
 0002           ;       UBRRL = 0x07; //set baud rate lo
 0002           ;       UBRRH = 0x00; //set baud rate hi
 0002           ;       UCSRB = 0x98;
 0002           ; 
 0002           ; #endif
 0002           ; #ifdef UART9600
 0002           ; UCSRB = 0x00; //disable while setting baud rate
 0002 2224              clr R2
 0004 2AB8              out 0xa,R2
 0006                   .dbline 50
 0006           ; UCSRA = 0x00;
 0006 2BB8              out 0xb,R2
 0008                   .dbline 51
 0008           ; UCSRC = BIT(URSEL) | 0x06;
 0008 86E8              ldi R24,134
 000A 80BD              out 0x20,R24
 000C                   .dbline 53
 000C           ; 
 000C           ; UBRRL = 0x2F; //set baud rate lo
 000C 8FE2              ldi R24,47
 000E 89B9              out 0x9,R24
 0010                   .dbline 54
 0010           ; UBRRH = 0x00; //set baud rate hi
 0010 20BC              out 0x20,R2
 0012                   .dbline 55
 0012           ; UCSRB = 0x98;
 0012 88E9              ldi R24,152
 0014 8AB9              out 0xa,R24
 0016                   .dbline -2
 0016           L1:
 0016                   .dbline 0 ; func end
 0016 0895              ret
 0018                   .dbend
 0018                   .dbfunc e USART_Transmit _USART_Transmit fV
 0018           ;           data -> R16
                        .even
 0018           _USART_Transmit::
 0018                   .dbline -1
 0018                   .dbline 62
 0018           ; 
 0018           ; #endif
 0018           ; #endif
 0018           ; }
 0018           ; 
 0018           ; void USART_Transmit( unsigned char data )     //发送模块，该程序没用到
 0018           ; {
 0018           L3:
 0018                   .dbline 65
 0018           ;       /* Wait for empty transmit buffer */
 0018           ;       while( !( UCSRA & (1<<UDRE)))/* Put data into buffer, sends the data */
 0018           ;               ;
 0018           L4:
 0018                   .dbline 64
 0018 5D9B              sbis 0xb,5
 001A FECF              rjmp L3
 001C           X0:
 001C                   .dbline 66
 001C           ;       UDR = data;
 001C 0CB9              out 0xc,R16
 001E                   .dbline -2
 001E           L2:
 001E                   .dbline 0 ; func end
 001E 0895              ret
 0020                   .dbsym r data 16 c
 0020                   .dbend
 0020                   .dbfunc e USART_send_str _USART_send_str fV
 0020           ;              i -> R10,R11
 0020           ;            str -> R20,R21
                        .even
 0020           _USART_send_str::
 0020 0E940000          xcall push_xgset300C
 0024 A801              movw R20,R16
 0026                   .dbline -1
 0026                   .dbline 69
 0026           ; }
 0026           ; void USART_send_str(unsigned char * str)              //发送字符串
 0026           ; {
 0026                   .dbline 70
 0026           ;       int i=0;
 0026 AA24              clr R10
 0028 BB24              clr R11
 002A 04C0              xjmp L8
 002C           L7:
 002C                   .dbline 71
 002C           ;       while(*(str++)!= 0){
 002C                   .dbline 72
 002C           ;               USART_Transmit(*(str-1));
 002C FA01              movw R30,R20
 002E 3197              sbiw R30,1
 0030 0081              ldd R16,z+0
 0032 F2DF              xcall _USART_Transmit
 0034                   .dbline 73
 0034           ;       }
 0034           L8:
 0034                   .dbline 71
 0034 FA01              movw R30,R20
 0036 2190              ld R2,Z+
 0038 AF01              movw R20,R30
 003A 2220              tst R2
 003C B9F7              brne L7
 003E           X1:
 003E                   .dbline 74
 003E           ;       USART_Transmit('\r');
 003E 0DE0              ldi R16,13
 0040 EBDF              xcall _USART_Transmit
 0042                   .dbline 75
 0042           ;       USART_Transmit('\n');
 0042 0AE0              ldi R16,10
 0044 E9DF              xcall _USART_Transmit
 0046                   .dbline -2
 0046           L6:
 0046                   .dbline 0 ; func end
 0046 0C940000          xjmp pop_xgset300C
 004A                   .dbsym r i 10 I
 004A                   .dbsym r str 20 pc
 004A                   .dbend
                        .area vector(rom, abs)
                        .org 44
 002C 0C942500          jmp _uart0_rx_isr
                        .area text(rom, con, rel)
 004A                   .dbfile D:\monitor\software\source\uart.c
                        .area data(ram, con, rel)
 0000                   .dbfile D:\monitor\software\source\uart.c
 0000           L11:
 0000                   .blkb 1
                        .area idata
 0000 00                .byte 0
                        .area data(ram, con, rel)
 0001                   .dbfile D:\monitor\software\source\uart.c
 0001           L12:
 0001                   .blkb 1
                        .area idata
 0001 00                .byte 0
                        .area data(ram, con, rel)
 0002                   .dbfile D:\monitor\software\source\uart.c
                        .area text(rom, con, rel)
 004A                   .dbfile D:\monitor\software\source\uart.c
 004A                   .dbfunc e uart0_rx_isr _uart0_rx_isr fV
 004A                   .dbsym s i L12 c
 004A                   .dbsym s flag L11 c
 004A           ;           data -> R20
                        .even
 004A           _uart0_rx_isr::
 004A 0A92              st -y,R0
 004C 1A92              st -y,R1
 004E 2A92              st -y,R2
 0050 3A92              st -y,R3
 0052 4A92              st -y,R4
 0054 5A92              st -y,R5
 0056 6A92              st -y,R6
 0058 7A92              st -y,R7
 005A 8A92              st -y,R8
 005C 9A92              st -y,R9
 005E 0A93              st -y,R16
 0060 1A93              st -y,R17
 0062 2A93              st -y,R18
 0064 3A93              st -y,R19
 0066 8A93              st -y,R24
 0068 9A93              st -y,R25
 006A AA93              st -y,R26
 006C BA93              st -y,R27
 006E EA93              st -y,R30
 0070 FA93              st -y,R31
 0072 0FB6              IN R0,63
 0074 0A92              st -y,R0
 0076 4A93              st -y,R20
 0078                   .dbline -1
 0078                   .dbline 80
 0078           ; }
 0078           ; 
 0078           ; #pragma interrupt_handler uart0_rx_isr:iv_USART0_RXC
 0078           ; void uart0_rx_isr(void)
 0078           ; {
 0078                   .dbline 85
 0078           ;        //uart has received a character in UDR
 0078           ;        static u8 flag = 0;
 0078           ;        u8 data;
 0078           ;        static u8 i= 0;
 0078           ;        data = UDR;
 0078 4CB1              in R20,0xc
 007A                   .dbline 86
 007A           ;        if((1==flag)&&('K'==data)){
 007A 80910000          lds R24,L11
 007E 8130              cpi R24,1
 0080 59F4              brne L13
 0082           X2:
 0082 4B34              cpi R20,75
 0084 49F4              brne L13
 0086           X3:
 0086                   .dbline 86
 0086                   .dbline 87
 0086           ;                okflag = 1;
 0086 81E0              ldi R24,1
 0088 90E0              ldi R25,0
 008A 90930100          sts _okflag+1,R25
 008E 80930000          sts _okflag,R24
 0092                   .dbline 88
 0092           ;                i=0;
 0092 2224              clr R2
 0094 20920100          sts L12,R2
 0098                   .dbline 89
 0098           ;        }
 0098           L13:
 0098                   .dbline 90
 0098           ;        if('O'==data)
 0098 4F34              cpi R20,79
 009A 19F4              brne L15
 009C           X4:
 009C                   .dbline 91
 009C           ;               flag = 1;
 009C 81E0              ldi R24,1
 009E 80930000          sts L11,R24
 00A2           L15:
 00A2                   .dbline 93
 00A2           ; 
 00A2           ;        if((4==flag)&&('G'==data)){
 00A2 80910000          lds R24,L11
 00A6 8430              cpi R24,4
 00A8 29F4              brne L17
 00AA           X5:
 00AA 4734              cpi R20,71
 00AC 19F4              brne L17
 00AE           X6:
 00AE                   .dbline 93
 00AE                   .dbline 94
 00AE           ;                USART_send_str("ATA");
 00AE 00E0              ldi R16,<L19
 00B0 10E0              ldi R17,>L19
 00B2 B6DF              xcall _USART_send_str
 00B4                   .dbline 95
 00B4           ;        }
 00B4           L17:
 00B4                   .dbline 97
 00B4           ; 
 00B4           ;        if((3==flag)&&('N'==data)){
 00B4 80910000          lds R24,L11
 00B8 8330              cpi R24,3
 00BA 29F4              brne L20
 00BC           X7:
 00BC 4E34              cpi R20,78
 00BE 19F4              brne L20
 00C0           X8:
 00C0                   .dbline 97
 00C0                   .dbline 98
 00C0           ;                flag = 4;
 00C0 84E0              ldi R24,4
 00C2 80930000          sts L11,R24
 00C6                   .dbline 99
 00C6           ;        }
 00C6           L20:
 00C6                   .dbline 100
 00C6           ;        if((2==flag)&&('I'==data)){
 00C6 80910000          lds R24,L11
 00CA 8230              cpi R24,2
 00CC 29F4              brne L22
 00CE           X9:
 00CE 4934              cpi R20,73
 00D0 19F4              brne L22
 00D2           X10:
 00D2                   .dbline 100
 00D2                   .dbline 101
 00D2           ;                flag = 3;
 00D2 83E0              ldi R24,3
 00D4 80930000          sts L11,R24
 00D8                   .dbline 102
 00D8           ;        }
 00D8           L22:
 00D8                   .dbline 103
 00D8           ;        if('R'==data)
 00D8 4235              cpi R20,82
 00DA 19F4              brne L24
 00DC           X11:
 00DC                   .dbline 104
 00DC           ;               flag = 2;
 00DC 82E0              ldi R24,2
 00DE 80930000          sts L11,R24
 00E2           L24:
 00E2                   .dbline 106
 00E2           ;        
 00E2           ;        if(!okflag){
 00E2 20900000          lds R2,_okflag
 00E6 30900100          lds R3,_okflag+1
 00EA 2220              tst R2
 00EC 51F4              brne L26
 00EE 3320              tst R3
 00F0 41F4              brne L26
 00F2           X12:
 00F2                   .dbline 106
 00F2                   .dbline 107
 00F2           ;               mstxt[i] = data;
 00F2 80E0              ldi R24,<_mstxt
 00F4 90E0              ldi R25,>_mstxt
 00F6 E0910100          lds R30,L12
 00FA FF27              clr R31
 00FC E80F              add R30,R24
 00FE F91F              adc R31,R25
 0100 4083              std z+0,R20
 0102                   .dbline 108
 0102           ;        }
 0102           L26:
 0102                   .dbline -2
 0102           L10:
 0102                   .dbline 0 ; func end
 0102 4991              ld R20,y+
 0104 0990              ld R0,y+
 0106 0FBE              OUT 63,R0
 0108 F991              ld R31,y+
 010A E991              ld R30,y+
 010C B991              ld R27,y+
 010E A991              ld R26,y+
 0110 9991              ld R25,y+
 0112 8991              ld R24,y+
 0114 3991              ld R19,y+
 0116 2991              ld R18,y+
 0118 1991              ld R17,y+
 011A 0991              ld R16,y+
 011C 9990              ld R9,y+
 011E 8990              ld R8,y+
 0120 7990              ld R7,y+
 0122 6990              ld R6,y+
 0124 5990              ld R5,y+
 0126 4990              ld R4,y+
 0128 3990              ld R3,y+
 012A 2990              ld R2,y+
 012C 1990              ld R1,y+
 012E 0990              ld R0,y+
 0130 1895              reti
 0132                   .dbsym r data 20 c
 0132                   .dbend
                        .area data(ram, con, rel)
 0002                   .dbfile D:\monitor\software\source\uart.c
 0002           L19:
 0002                   .blkb 4
                        .area idata
 0002 41544100          .byte 'A,'T,'A,0
                        .area data(ram, con, rel)
 0006                   .dbfile D:\monitor\software\source\uart.c
 0006           ; 
 0006           ;        
 0006           ; }
