                        .module eeprom.c
                        .area text(rom, con, rel)
 0000                   .dbfile source\eeprom.c
 0000                   .dbfile D:\monitor\software\source\eeprom.c
 0000                   .dbfunc e EEPROM_write_byte _EEPROM_write_byte fV
 0000           ;         ucData -> R18
 0000           ;      uiAddress -> R16,R17
                        .even
 0000           _EEPROM_write_byte::
 0000                   .dbline -1
 0000                   .dbline 4
 0000           ; #include "define.h"
 0000           ; 
 0000           ; void EEPROM_write_byte(u16 uiAddress,u8 ucData)
 0000           ; {
 0000           L2:
 0000                   .dbline 6
 0000           ;       /*等待上一次写操作结束*/
 0000           ;       while(EECR &(1<<EEWE));
 0000           L3:
 0000                   .dbline 6
 0000 E199              sbic 0x1c,1
 0002 FECF              rjmp L2
 0004           X0:
 0004                   .dbline 8
 0004           ;       /*设置地址和数据寄存器*/
 0004           ;       EEAR=uiAddress;
 0004 1FBB              out 0x1f,R17
 0006 0EBB              out 0x1e,R16
 0008                   .dbline 9
 0008           ;       EEDR=ucData;
 0008 2DBB              out 0x1d,R18
 000A                   .dbline 11
 000A           ;       /*置位EEMWE*/
 000A           ;       EECR|=(1<<EEMWE);
 000A E29A              sbi 0x1c,2
 000C                   .dbline 13
 000C           ;       /*置位EEWE?以启动写操作*/
 000C           ;       EECR|=(1<<EEWE);
 000C E19A              sbi 0x1c,1
 000E                   .dbline -2
 000E           L1:
 000E                   .dbline 0 ; func end
 000E 0895              ret
 0010                   .dbsym r ucData 18 c
 0010                   .dbsym r uiAddress 16 i
 0010                   .dbend
 0010                   .dbfunc e EEPROM_read_byte _EEPROM_read_byte fc
 0010           ;      uiAddress -> R16,R17
                        .even
 0010           _EEPROM_read_byte::
 0010                   .dbline -1
 0010                   .dbline 16
 0010           ; }
 0010           ; u8 EEPROM_read_byte(u16 uiAddress)
 0010           ; {
 0010           L6:
 0010                   .dbline 18
 0010           ;       /*等待上一次写操作结束*/
 0010           ;       while(EECR & (1<<EEWE));
 0010           L7:
 0010                   .dbline 18
 0010 E199              sbic 0x1c,1
 0012 FECF              rjmp L6
 0014           X1:
 0014                   .dbline 20
 0014           ;       /*设置地址寄存器*/
 0014           ;       EEAR = uiAddress;
 0014 1FBB              out 0x1f,R17
 0016 0EBB              out 0x1e,R16
 0018                   .dbline 22
 0018           ;       /*设置EERE?以启动读操作*/
 0018           ;       EECR|=(1<<EERE);
 0018 E09A              sbi 0x1c,0
 001A                   .dbline 24
 001A           ;       /*自数据寄存器返回数据*/
 001A           ;       return EEDR;
 001A 0DB3              in R16,0x1d
 001C                   .dbline -2
 001C           L5:
 001C                   .dbline 0 ; func end
 001C 0895              ret
 001E                   .dbsym r uiAddress 16 i
 001E                   .dbend
 001E                   .dbfunc e EEPROM_write _EEPROM_write fV
 001E           ;              i -> R20,R21
 001E           ;         length -> R10,R11
 001E           ;           Data -> R12,R13
 001E           ;      uiAddress -> R14,R15
                        .even
 001E           _EEPROM_write::
 001E 0E940000          xcall push_xgset30FC
 0022 6901              movw R12,R18
 0024 7801              movw R14,R16
 0026 A884              ldd R10,y+8
 0028 B984              ldd R11,y+9
 002A                   .dbline -1
 002A                   .dbline 27
 002A           ; }
 002A           ; void EEPROM_write(u16 uiAddress,u8 *Data, int length)
 002A           ; {
 002A                   .dbline 29
 002A           ;       int i;
 002A           ;       for(i=0;i<length;i++){
 002A 4427              clr R20
 002C 5527              clr R21
 002E 0AC0              xjmp L13
 0030           L10:
 0030                   .dbline 29
 0030                   .dbline 30
 0030           ;               EEPROM_write_byte(uiAddress+i,Data[i]);
 0030 FA01              movw R30,R20
 0032 EC0D              add R30,R12
 0034 FD1D              adc R31,R13
 0036 2081              ldd R18,z+0
 0038 8701              movw R16,R14
 003A 040F              add R16,R20
 003C 151F              adc R17,R21
 003E E0DF              xcall _EEPROM_write_byte
 0040                   .dbline 31
 0040           ;       }
 0040           L11:
 0040                   .dbline 29
 0040 4F5F              subi R20,255  ; offset = 1
 0042 5F4F              sbci R21,255
 0044           L13:
 0044                   .dbline 29
 0044 4A15              cp R20,R10
 0046 5B05              cpc R21,R11
 0048 9CF3              brlt L10
 004A           X2:
 004A                   .dbline -2
 004A           L9:
 004A                   .dbline 0 ; func end
 004A 0C940000          xjmp pop_xgset30FC
 004E                   .dbsym r i 20 I
 004E                   .dbsym r length 10 I
 004E                   .dbsym r Data 12 pc
 004E                   .dbsym r uiAddress 14 i
 004E                   .dbend
 004E                   .dbfunc e EEPROM_read _EEPROM_read fV
 004E           ;              i -> R20,R21
 004E           ;         length -> R10,R11
 004E           ;           Data -> R12,R13
 004E           ;      uiAddress -> R14,R15
                        .even
 004E           _EEPROM_read::
 004E 0E940000          xcall push_xgset30FC
 0052 6901              movw R12,R18
 0054 7801              movw R14,R16
 0056 A884              ldd R10,y+8
 0058 B984              ldd R11,y+9
 005A                   .dbline -1
 005A                   .dbline 34
 005A           ; }
 005A           ; void EEPROM_read(u16 uiAddress,u8 *Data, int length)
 005A           ; {
 005A                   .dbline 36
 005A           ;       int i;
 005A           ;       for(i=0;i<length;i++){
 005A 4427              clr R20
 005C 5527              clr R21
 005E 0AC0              xjmp L18
 0060           L15:
 0060                   .dbline 36
 0060                   .dbline 37
 0060           ;               Data[i] = EEPROM_read_byte(uiAddress+i);
 0060 8701              movw R16,R14
 0062 040F              add R16,R20
 0064 151F              adc R17,R21
 0066 D4DF              xcall _EEPROM_read_byte
 0068 FA01              movw R30,R20
 006A EC0D              add R30,R12
 006C FD1D              adc R31,R13
 006E 0083              std z+0,R16
 0070                   .dbline 38
 0070           ;       }
 0070           L16:
 0070                   .dbline 36
 0070 4F5F              subi R20,255  ; offset = 1
 0072 5F4F              sbci R21,255
 0074           L18:
 0074                   .dbline 36
 0074 4A15              cp R20,R10
 0076 5B05              cpc R21,R11
 0078 9CF3              brlt L15
 007A           X3:
 007A                   .dbline -2
 007A           L14:
 007A                   .dbline 0 ; func end
 007A 0C940000          xjmp pop_xgset30FC
 007E                   .dbsym r i 20 I
 007E                   .dbsym r length 10 I
 007E                   .dbsym r Data 12 pc
 007E                   .dbsym r uiAddress 14 i
 007E                   .dbend
 007E           ; }
 007E           ; 
 007E           ; 
